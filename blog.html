<!DOCTYPE html>
<!--
	24 News by FreeHTML5.co
	Twitter: https://twitter.com/fh5co
	Facebook: https://fb.com/fh5co
	URL: https://freehtml5.co
-->
<html lang="en" class="no-js">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>24 News — Free Website Template, Free HTML5 Template by FreeHTML5.co</title>
    <link href="css/media_query.css" rel="stylesheet" type="text/css" />
    <link href="css/bootstrap.css" rel="stylesheet" type="text/css" />
    <link
        href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
        rel="stylesheet"
        integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN"
        crossorigin="anonymous"
    />
    <link href="css/animate.css" rel="stylesheet" type="text/css" />
    <link href="https://fonts.googleapis.com/css?family=Poppins" rel="stylesheet" />
    <link href="css/owl.carousel.css" rel="stylesheet" type="text/css" />
    <link href="css/owl.theme.default.css" rel="stylesheet" type="text/css" />
    <!-- Bootstrap CSS -->
    <link href="css/style_1.css" rel="stylesheet" type="text/css" />
    <!-- FullCalendar CSS -->
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet" />
    <!-- Modernizr JS -->
    <script src="js/modernizr-3.5.0.min.js"></script>
</head>

<body>
    <div class="container-fluid fh5co_header_bg">
        <div class="container">
            <div class="row">
                <div class="col-12 fh5co_mediya_center">
                    <a href="#" class="color_fff fh5co_mediya_setting">
                        <i>
                            <div class="d-inline-block fh5co_trading_posotion_relative">
                                <a href="#" class="treding_btn">Trending</a>
                                <div class="fh5co_treding_position_absolute"></div>
                            </div>
                        </i>
                    </a>
                </div>
            </div>
        </div>
    </div>
    <div class="container-fluid">
        <div class="container">
            <div class="row">
                <div class="col-12 col-md-3 fh5co_padding_menu">
                    <img src="images/logo-light.png" alt="img" class="fh5co_logo_width" />
                </div>
                <div class="col-12 col-md-9 align-self-center fh5co_mediya_right">
                    <div class="text-center d-inline-block">
                        <a class="fh5co_display_table">
                            <div class="fh5co_verticle_middle"><i class="fa fa-search"></i></div>
                        </a>
                    </div>
                    <div class="text-center d-inline-block">
                        <a class="fh5co_display_table">
                            <div class="fh5co_verticle_middle"><i class="fa fa-linkedin"></i></div>
                        </a>
                    </div>
                    <div class="text-center d-inline-block">
                        <a class="fh5co_display_table">
                            <div class="fh5co_verticle_middle"><i class="fa fa-google-plus"></i></div>
                        </a>
                    </div>
                    <div class="text-center d-inline-block">
                        <a href="https://twitter.com/fh5co" target="_blank" class="fh5co_display_table">
                            <div class="fh5co_verticle_middle"><i class="fa fa-twitter"></i></div>
                        </a>
                    </div>
                    <div class="text-center d-inline-block">
                        <a href="https://fb.com/fh5co" target="_blank" class="fh5co_display_table">
                            <div class="fh5co_verticle_middle"><i class="fa fa-facebook"></i></div>
                        </a>
                    </div>
                    <div class="clearfix"></div>
                </div>
            </div>
        </div>
    </div>
    <div class="container-fluid bg-faded fh5co_padd_mediya padding_786">
        <div class="container padding_786">
            <nav class="navbar navbar-toggleable-md navbar-light ">
                <button
                    class="navbar-toggler navbar-toggler-right mt-3"
                    type="button"
                    data-toggle="collapse"
                    data-target="#navbarSupportedContent"
                    aria-controls="navbarSupportedContent"
                    aria-expanded="false"
                    aria-label="Toggle navigation"
                >
                    <span class="fa fa-bars"></span>
                </button>
                <a class="navbar-brand" href="#"
                    ><img src="images/logo.png" alt="img" class="mobile_logo_width" /></a
                >
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item active">
                            <a class="nav-link" href="index.html"
                                >Home <span class="sr-only">(current)</span></a
                            >
                        </li>
                        <li class="nav-item ">
                            <a class="nav-link" href="blog.html"
                                >Blog <span class="sr-only">(current)</span></a
                            >
                        </li>
                        <li class="nav-item ">
                            <a class="nav-link" href="single.html"
                                >Single <span class="sr-only">(current)</span></a
                            >
                        </li>
                    </ul>
                </div>
            </nav>
        </div>
    </div>

    <!-- Conteúdo dinâmico -->
    <div class="container-fluid pb-4 pt-4 paddding">
        <div class="container paddding">
            <div class="row mx-0">
                <div class="col-md-8 animate-box" data-animate-effect="fadeInLeft">
                    <div>
                        <div class="fh5co_heading fh5co_heading_border_bottom py-2 mb-4">News</div>
                    </div>
                    <div id="news-container" class="news-list">
                        <!-- Notícias da API vão aparecer aqui -->
                    </div>
                </div>
                <div class="col-md-4 animate-box" data-animate-effect="fadeInRight">
                    <div>
                        <div class="fh5co_heading fh5co_heading_border_bottom py-2 mb-4">Eventos</div>
                    </div>
                    <div id="events-container" class="events-list" style="min-height: 400px;">
                        <!-- FullCalendar vai renderizar aqui -->
                    </div>

                    <div style="margin-top:40px;">
                        <div class="fh5co_heading fh5co_heading_border_bottom py-2 mb-4">Enquetes</div>
                    </div>
                    <div id="polls-container" class="polls-list">
                        <!-- Enquetes da API vão aparecer aqui -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="gototop js-top">
        <a href="#" class="js-gotop"><i class="fa fa-arrow-up"></i></a>
    </div>

    <!-- Scripts externos -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="js/owl.carousel.min.js"></script>
    <!--<script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" integrity="sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n" crossorigin="anonymous"></script>-->
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js"
        integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb"
        crossorigin="anonymous"
    ></script>
    <script
        src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js"
        integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn"
        crossorigin="anonymous"
    ></script>
    <!-- Waypoints -->
    <script src="js/jquery.waypoints.min.js"></script>
    <!-- Main -->
    <script src="js/main.js"></script>

    <!-- FullCalendar JS -->
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>

    <!-- Nosso script para puxar API e renderizar conteúdos -->
    <script>
        const API_BASE = 'http://3.19.193.161/api';

        // Função para formatar datas em DD/MM/YYYY
        function formatDate(dateStr) {
            const d = new Date(dateStr);
            if (isNaN(d)) return '';
            return d.toLocaleDateString('pt-BR');
        }

        // Carrega notícias e insere no #news-container
        async function loadNews() {
            try {
                const res = await fetch(`${API_BASE}/noticias`);
                if (!res.ok) throw new Error('Erro ao buscar notícias');
                const data = await res.json();

                const container = document.getElementById('news-container');
                container.innerHTML = '';

                data.forEach((noticia) => {
                    const html = `
                    <div class="row pb-4">
                        <div class="col-md-5">
                            <div class="fh5co_hover_news_img">
                                <div class="fh5co_news_img">
                                    <img src="${
                                        noticia.imagem || 'images/nathan-mcbride-229637.jpg'
                                    }" alt="${noticia.titulo}" />
                                </div>
                            </div>
                        </div>
                        <div class="col-md-7 animate-box">
                            <a href="single.html?id=${noticia.id}" class="fh5co_magna py-2">${noticia.titulo}</a>
                            <a href="#" class="fh5co_mini_time py-3">${
                                noticia.autor || 'Autor'
                            } - ${formatDate(noticia.data)}</a>
                            <div class="fh5co_consectetur">${
                                noticia.resumo ||
                                (noticia.conteudo
                                    ? noticia.conteudo.substring(0, 150) + '...'
                                    : '')
                            }</div>
                        </div>
                    </div>`;
                    container.insertAdjacentHTML('beforeend', html);
                });
            } catch (error) {
                console.error('Erro ao carregar notícias:', error);
                document.getElementById('news-container').innerHTML =
                    '<p>Não foi possível carregar as notícias.</p>';
            }
        }

        // Inicializa e carrega o FullCalendar com eventos da API
        async function loadCalendar() {
            try {
                const res = await fetch(`${API_BASE}/eventos`);
                if (!res.ok) throw new Error('Erro ao buscar eventos');
                const data = await res.json();

                // Mapeia os dados da API para o formato esperado pelo FullCalendar
                const events = data.map(evento => ({
                    id: evento.id,
                    title: evento.titulo,
                    start: evento.data_evento,
                    description: evento.descricao || ''
                }));

                const calendarEl = document.getElementById('events-container');
                calendarEl.innerHTML = ''; // limpa antes

                const calendar = new FullCalendar.Calendar(calendarEl, {
                    initialView: 'dayGridMonth',
                    locale: 'pt-br',
                    headerToolbar: {
                        left: 'prev,next today',
                        center: 'title',
                        right: 'dayGridMonth,timeGridWeek,timeGridDay'
                    },
                    events: events,
                    eventDidMount: function(info) {
                        if (info.event.extendedProps.description) {
                            info.el.setAttribute('title', info.event.extendedProps.description);
                        }
                    },
                    eventClick: function(info) {
                        alert(`Evento: ${info.event.title}\nDescrição: ${info.event.extendedProps.description || 'Sem descrição'}`);
                    }
                });

                calendar.render();
            } catch (error) {
                console.error('Erro ao carregar calendário:', error);
                document.getElementById('events-container').innerHTML = '<p>Não foi possível carregar o calendário de eventos.</p>';
            }
        }

        // Carrega enquetes e insere no #polls-container
        async function loadPolls() {
            try {
                const res = await fetch(`${API_BASE}/enquetes`);
                if (!res.ok) throw new Error('Erro ao buscar enquetes');
                const data = await res.json();

                const container = document.getElementById('polls-container');
                container.innerHTML = '';

                data.forEach((enquete) => {
                    let opcoes = [];
                    let votos = [];
                    try {
                        opcoes = enquete.opcoes ? JSON.parse(enquete.opcoes) : [];
                        votos = enquete.votos ? JSON.parse(enquete.votos) : [];
                    } catch {
                        // caso não seja JSON válido, usa arrays vazios
                    }
                    let totalVotos = votos.reduce((a, b) => a + b, 0);

                    let optionsHtml = '';
                    opcoes.forEach((opcao, i) => {
                        const pct = totalVotos > 0 ? ((votos[i] / totalVotos) * 100).toFixed(1) : 0;
                        optionsHtml += `<li>${opcao}: ${votos[i] || 0} votos (${pct}%)</li>`;
                    });

                    const html = `
                    <div style="margin-bottom:20px;">
                        <h5>${enquete.pergunta}</h5>
                        <ul>${optionsHtml}</ul>
                    </div>`;
                    container.insertAdjacentHTML('beforeend', html);
                });
            } catch (error) {
                console.error('Erro ao carregar enquetes:', error);
                document.getElementById('polls-container').innerHTML =
                    '<p>Não foi possível carregar as enquetes.</p>';
            }
        }

        // Executa tudo após carregar o DOM
        document.addEventListener('DOMContentLoaded', () => {
            loadNews();
            loadCalendar();
            loadPolls();
        });
    </script>
</body>

</html>
